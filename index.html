<!DOCTYPE html>
<html>
<head>
<style>
.calendar-table {
  width: 100%;
  border-collapse: collapse;
}

.calendar-table td, .calendar-table th {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: center;
}

.calendar-table th {
  background-color: #f2f2f2;
}

.current-day {
  background-color: #f0f0f0;
}

.fade-in {
  animation: fadeIn 0.5s ease-in-out;
}

@keyframes fadeIn {
  0% { opacity: 0; }
  100% { opacity: 1; }
}

.time-table {
  margin-top: 10px;
  border-collapse: collapse;
  width: 100%;
}

.time-table td, .time-table th {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: center;
}

.time-table th {
  background-color: #f2f2f2;
}

.time-slot {
  cursor: pointer;
}

.time-slot.selected {
  background-color: #f0f0f0;
}
</style>
</head>
<body>

<div class="calendar-container">
  <h2>Контент-план</h2>
  <div id="calendar"></div>
  <button id="nextMonthBtn">Следующий месяц</button>
</div>

<div id="time-selector" style="display: none">
  <h3>Выберите время и введите текст:</h3>
  <table class="time-table">
    <thead>
      <tr>
        <th>Время</th>
        <th>Текст</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="time-slot" data-hour="9" data-minute="00">09:00</td>
        <td><input type="text" data-hour="9" data-minute="00"></td>
      </tr>
      <tr>
        <td class="time-slot" data-hour="10" data-minute="00">10:00</td>
        <td><input type="text" data-hour="10" data-minute="00"></td>
      </tr>
      <!-- Добавьте больше строк для других временных интервалов -->
    </tbody>
  </table>
  <button id="save-button">Сохранить</button>
</div>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<script>
  let tg = window.Telegram.WebApp; //получаем объект webapp телеграма 
  tg.expand(); //расширяем на все окно  


function generateCalendar(month, year) {
  const monthNames = [
    "Январь", "Февраль", "Март", "Апрель", "Май", "Июнь",
    "Июль", "Август", "Сентябрь", "Октябрь", "Ноябрь", "Декабрь"
  ];

  const calendarTable = document.createElement("table");
  calendarTable.classList.add("calendar-table", "fade-in");

  const headerRow = calendarTable.insertRow();
  const headerCell = headerRow.insertCell();
  headerCell.colSpan = 7;
  headerCell.innerHTML = monthNames[month] + " " + year;

  const daysOfWeek = ["Пн", "Вт", "Ср", "Чт", "Пт", "Сб", "Вс"];
  const daysRow = calendarTable.insertRow();
  daysOfWeek.forEach(day => {
    const dayCell = daysRow.insertCell();
    dayCell.innerHTML = day;
  });

  let firstDay = (new Date(year, month)).getDay() - 1; 
  if (firstDay === -1) { 
    firstDay = 6;
  }

  const daysInMonth = 32 - new Date(year, month, 32).getDate();

  const today = new Date();
  const currentDay = today.getDate();

  let date = 1;
  for (let i = 0; i < 6; i++) {
    const row = calendarTable.insertRow();
    for (let j = 0; j < 7; j++) {
      const cell = row.insertCell();
      if (i === 0 && j < firstDay) {
        cell.innerHTML = "";
      } else if (date > daysInMonth) {
        break;
      } else {
        const link = document.createElement('a');
        link.href = "#"; 
        link.textContent = date;
        link.dataset.date = `${year}-${month + 1}-${date}`; 
        link.addEventListener('click', showTimeSelector); 
        cell.appendChild(link);

        if (date === currentDay && month === today.getMonth() && year === today.getFullYear()) {
          cell.classList.add("current-day");
        }
        date++;
      }
    }
  }

  return calendarTable;
}

const calendarContainer = document.getElementById("calendar");
const nextMonthBtn = document.getElementById("nextMonthBtn");
const timeSelector = document.getElementById('time-selector');
const saveButton = document.getElementById('save-button');

let currentMonth = new Date().getMonth();
let currentYear = new Date().getFullYear();

calendarContainer.appendChild(generateCalendar(currentMonth, currentYear));

nextMonthBtn.addEventListener("click", () => {
  currentMonth++;
  if (currentMonth > 11) {
    currentMonth = 0;
    currentYear++;
  }
  calendarContainer.innerHTML = ''; //если хотим, чтобы показывался только следующий месяц
  calendarContainer.appendChild(generateCalendar(currentMonth, currentYear));
});

function showTimeSelector(event) {
  event.preventDefault(); 
  const clickedDate = event.target.dataset.date;
  const selectedDate = new Date(clickedDate);

  // Отобразите выбранную дату где-то, например:
  console.log("Выбранная дата:", selectedDate);

  // Отобразите timeSelector
  timeSelector.style.display = "block";
}

// Добавляем обработчик события для сохранения данных
saveButton.addEventListener('click', () => {
  // Получаем выбранную дату
  const selectedDate = document.querySelector('.time-slot.selected');
  if (!selectedDate) {
    alert('Пожалуйста, выберите время!');
    return;
  }

  const selectedHour = selectedDate.dataset.hour;
  const selectedMinute = selectedDate.dataset.minute;
  const selectedTextInput = document.querySelector(`input[data-hour="${selectedHour}"][data-minute="${selectedMinute}"]`);
  const enteredText = selectedTextInput.value;

  // Отправляем данные на сервер (или выполняем другие действия)
  console.log('Выбранная дата:', selectedDate.dataset.date);
  console.log('Выбранное время:', selectedHour, ':', selectedMinute);
  console.log('Введенный текст:', enteredText);

  let userId = tg.initDataUnsafe.user.id;
  console.log('user_id:', userId);

  // Сбрасываем выделение и скрываем форму
  timeSelector.style.display = "none";
});

// Добавляем обработчики событий для выбора времени
const timeSlots = document.querySelectorAll('.time-slot');
timeSlots.forEach(slot => {
  slot.addEventListener('click', () => {
    // Удаляем выделение с предыдущего слота
    const currentlySelected = document.querySelector('.time-slot.selected');
    if (currentlySelected) {
      currentlySelected.classList.remove('selected');
    }

    // Выделяем текущий слот
    slot.classList.add('selected');
  });
});
</script>
</body>
</html>